name: Check Version

on:
  pull_request:
    branches: [ "master" ]

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
    
    - uses: actions/checkout@v3
    
    - name: Get version
      run: echo "VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)" >> $GITHUB_ENV
    
    - name: Print version
      run: echo "Version is ${{ env.VERSION }}"
        
    - name: Check snapshot
      if: ${{ !contains( env.VERSION , '-SNAPSHOT' ) }}
      uses: actions/github-script@v3
      with: 
          script: core.setFailed('Version is not SNAPSHOT')
          
    - name: Check minor
      if: ${{ !contains( env.VERSION , '.0-SNAPSHOT' ) }}
      run: echo "Version ${{ env.VERSION }} cannot contain new features"  

    - name: Check major
      if: ${{ !contains( env.VERSION , '.0.0-SNAPSHOT' ) }}
      run: echo "Version ${{ env.VERSION }} cannot contain breaking changes"  
